{% extends "index.html" %}
{% block contenido %}
<div class="container py-4" style="max-width: 820px;">
  <div class="mb-3">
    <h2 class="m-0">Crear multa</h2>
    <div class="text-muted">
      Deterioro: 5 o 10. Pérdida: 20. Retraso se suma solo si hubo retraso.
      (Los préstamos con libro inactivo se muestran como historial pero no se pueden seleccionar.)
    </div>
  </div>

  <form method="post" class="card shadow-sm p-3">
    {% csrf_token %}

    <div class="mb-3">
      <label class="form-label">Préstamo</label>
      <select name="prestamo" class="form-select" required>
        {% for p in prestamos %}
          <option value="{{ p.id }}" {% if p.libro.activo is False %}disabled{% endif %}>
            {% if p.libro.activo is False %}[INACTIVO] {% endif %}
            #{{ p.id }} | {{ p.usuario.username }} | {{ p.libro }}
            | máx: {{ p.fecha_max }}
            | retraso: {{ p.dias_retraso }} días
            | multa retraso: ${{ p.multa_retraso }}
          </option>
        {% empty %}
          <option disabled>No hay préstamos disponibles</option>
        {% endfor %}
      </select>
      <div class="form-text">
        Si un préstamo aparece como INACTIVO, significa que el libro fue dado de baja (soft delete).
      </div>
    </div>

    <div class="mb-3">
      <label class="form-label">Tipo</label>
      <select name="tipo" class="form-select" required>
        <option value="r">Retraso (solo si aplica)</option>
        <option value="d">Deterioro (retraso si aplica + extra)</option>
        <option value="p">Pérdida (retraso si aplica + 20)</option>
      </select>
    </div>

    <div class="mb-3">
      <label class="form-label">Extra (solo deterioro)</label>
      <select name="extra" class="form-select">
        <option value="">(Sin extra)</option>
        <option value="5.00">Deterioro leve: 5.00</option>
        <option value="10.00">Deterioro grave: 10.00</option>
      </select>
      <div class="form-text">Para pérdida el sistema usa 20 automáticamente.</div>
    </div>

    <div class="d-flex gap-2">
      <button class="btn btn-primary" type="submit">Crear multa</button>
      <a class="btn btn-outline-secondary" href="{% url 'lista_multa' %}">Cancelar</a>
    </div>
  </form>
</div>
{% endblock %}
